@{
    Layout = "~/Shared/_Layout.cshtml";
    Page.Title = "Trajectoverzicht";

    string action = "";

    Session["loginError"] = "";
    if (IsPost)
    {
        action = Request["action"];

        switch (action)
        {
            case "login":
                if (Session["cursist"] == null)
                {
                    try
                    {
                        Session["cursist"] = Administratix.Model.Cursist.Login(Request["Login-CursistNummer"]);
                    }
                    catch (Exception e)
                    {
                        Session["loginError"] = e.Message;
                    }

                }
                break;

            case "logout":
                Session["cursist"] = null;
                break;

        }
    }

    if (Session["cursist"] == null)
    {
        Response.Redirect("~/Deelpagina's/Default.cshtml");
    }

    List<Administratix.BLL.StatusTraject> Resultaat = new List<Administratix.BLL.StatusTraject>();
    List<Administratix.BLL.Module> trajectModules = new List<Administratix.BLL.Module>();
    List<Administratix.BLL.CursusResultaat> resultaten = new List<Administratix.BLL.CursusResultaat>();
    List<KeyValuePair<int, int>> voorkennisPairs = new List<KeyValuePair<int, int>>();

    if (Session["cursist"] != null)
    {
        Administratix.BLL.Cursist cursist = (Administratix.BLL.Cursist)Session["cursist"];
        // Haal trajectmodules op
        trajectModules = Administratix.Model.TrajectOverzicht.SelectTrajectModulesByCursistNummer(cursist.CursistNummer);
        // Haal cursist resultaten op
        resultaten = Administratix.Model.CursusResultaat.CursusResultaatSelectAllByCursistNummer(cursist.CursistNummer);
        // Voeg punten toe een trajectmodules
        trajectModules = Administratix.Model.TrajectOverzicht.CombineerModuleResultatenMetTrajectModules(trajectModules, resultaten);
        // Haal nodige voorkenis op, 140 == Informatica
        voorkennisPairs = Administratix.Model.TrajectOverzicht.SelectVoorkennisIdsByOpleidingsvariantId(140);
        // Voeg nodige voorkennis toe aan trqjectmodules
        Administratix.Model.TrajectOverzicht.ModulesAddVoorkennis(trajectModules, voorkennisPairs);

        trajectModules = trajectModules.OrderBy(o => o.Naam).ToList();

        //Resultaat = Administratix.Model.StatusTraject.SelectStatusByCursistNummer(Convert.ToInt32(Request["StatusTraject-CursistNummer"]));

    }
    
}


    
            <div class="containerBig">
                <div class="containerTitle">
                    Legende
                </div>
                <div class="legendeItems">
                    <div class="legendeItem">
                        <div class="iconBg">
                            <img class="img_StatusCirkelBlauw" />
                        </div>Geen punten

                    </div>
                    <div class="legendeItem">
                        <div class="iconBg">
                            <img class="img_StatusCirkelGroen" />
                        </div>Geslaagd.

                    </div>
                    <div class="legendeItem">
                        <div class="iconBg">
                            <img class="img_StatusCirkelRood" />
                        </div>Niet geslaagd.

                    </div>
                    <div class="legendeItem">
                        <div class="iconBg">
                            <img class="img_StatusNoteRood" />
                        </div>Onvoldoende voorkennis.
                        
                    </div>
                    <div class="legendeItem">
                        <div class="iconBg">
                            <img class="img_StatusNoteGroen" />
                        </div>Voldoende voorkennis.

                    </div>
                </div>
            </div>

            @if (trajectModules.Count <= 0)
            {
                <p>Je bent nog niet ingeschreven in een traject.</p>
            }
            else
            {
                <div class="itemContainer">
                    @for (int i = 0; i < trajectModules.Count; i++)
                    {
                        Administratix.BLL.Module module = trajectModules[i];
                        <div class="itemBox" id="@module.Id">
                            <a class="itemTitle" href="#@module.Id">

                                
                                    @if (module.CursistIsIngeschreven)
                                    {
                                        // Cursist is ingeschreven, geef punte status weer
                                        if (module.PuntenTotaal > 0)
                                        {
                                            // Cursist heeft punten
                                            if (module.CursistIsGeslaagd)
                                            {
                                                <img class="iconCenter img_StatusCirkelGroen" />
                                            }
                                            else
                                            {
                                                <img class="iconCenter img_StatusCirkelRood" />
                                            }
                                        }
                                        else
                                        {
                                            // Cursist heeft nog geen punten
                                            <img class="iconCenter img_StatusCirkelBlauw" />
                                        }
                                    }
                                    else
                                    {
                                        // Cursist is niet ingeschreven, geen inschrijf status weer
                                        if (module.CursistHeeftVoorkennis)
                                        {
                                            <img class="iconCenter img_StatusNoteGroen" />
                                        }
                                        else
                                        {
                                            <img class="iconCenter img_StatusNoteRood" />
                                        }
                                    }

                                @module.Naam
                                @if (module.VoorkennisModules.Count != 0)
                                {
                                    <div class="iconExpand">▼</div>
                                }

                            </a>
                            @if (module.VoorkennisModules.Count != 0)
                            {
                                <div class="itemContent">
                                    @*@foreach (Administratix.BLL.Module voorkennis in module.VoorkennisModules)
                                        {*@
                                    <div class="itemContentTitle">
                                        nodige voorkennis
                                    </div>

                                    @for (int j = 0; j < module.VoorkennisModules.Count; j++)
                                    {
                                        Administratix.BLL.Module voorkennis = module.VoorkennisModules[j];
                                        <div class="itemContentText @(j % 2 == 0 ? "" : "shaded")">
                                            <div class="iconBg">
                                                @if (voorkennis.CursistIsIngeschreven)
                                                {

                                                    if (voorkennis.PuntenTotaal > 0)
                                                    {
                                                        // Cursist heeft punten
                                                        if (voorkennis.CursistIsGeslaagd)
                                                        {
                                                            <img class="img_StatusCirkelGroen" />
                                                        }
                                                        else
                                                        {
                                                            <img class="img_StatusCirkelRood" />
                                                        }
                                                    }
                                                    else
                                                    {
                                                        // Cursist heeft nog geen punten
                                                        <img class="img_StatusCirkelBlauw" />

                                                    }
                                                }
                                                else
                                                {
                                                    // Cursist is niet ingeschreven, geen inschrijf status weer
                                                    if (voorkennis.CursistHeeftVoorkennis)
                                                    {
                                                        <img class="img_StatusNoteGroen" />
                                                    }
                                                    else
                                                    {
                                                        <img class="img_StatusNoteRood" />
                                                    }
                                                }
                                            </div>
                                                @voorkennis.Naam

                                            </div>
                                    }
                                </div>
                            }
                        </div>
                    }
                </div>

                @*<div class="containerTraject">
                            <div class="itemTraject containerTitle">Naam</div>
                            <div class="itemTraject containerTitle">Voorkennis</div>
                            @for (int i = 0; i < trajectModules.Count; i++)
                    {
                        Administratix.BLL.Module module = trajectModules[i];


                                <div class="itemTraject @(i%2 == 0 ? "":"shaded")">

                                    @if (module.CursistIsIngeschreven)
                            {
                                // Cursist is ingeschreven, geef punte status weer
                                if (module.PuntenTotaal > 0)
                                {
                                    // Cursist heeft punten
                                    if (module.CursistIsGeslaagd)
                                    {
                                        <img class="img_StatusCirkelGroen" />
                                    }
                                    else
                                    {
                                        <img class="img_StatusCirkelRood" />
                                    }
                                }
                                else
                                {
                                    // Cursist heeft nog geen punten
                                    <img class="img_StatusCirkelBlauw" />
                                }
                            }
                            else
                            {
                                // Cursist is niet ingeschreven, geen inschrijf status weer
                                if (module.CursistHeeftVoorkennis)
                                {
                                    <img class="img_StatusNoteGroen" />
                                }
                                else
                                {
                                    <img class="img_StatusNoteRood" />
                                }
                            }
                                    @module.Naam
                                </div>

                                <div class="itemTraject @(i%2 == 0 ? "":"shaded")">
                                    @foreach (Administratix.BLL.Module voorkennis in module.VoorkennisModules)
                            {
                                        <div>
                                            @if (voorkennis.CursistIsIngeschreven)
                                    {

                                        if (voorkennis.PuntenTotaal > 0)
                                        {
                                            // Cursist heeft punten
                                            if (voorkennis.CursistIsGeslaagd)
                                            {
                                                <img class="img_StatusCirkelGroen" />
                                            }
                                            else
                                            {
                                                <img class="img_StatusCirkelRood" />
                                            }
                                        }
                                        else
                                        {
                                            // Cursist heeft nog geen punten
                                            <img class="img_StatusCirkelBlauw" />

                                        }
                                    }
                                    else
                                    {
                                        // Cursist is niet ingeschreven, geen inschrijf status weer
                                        if (voorkennis.CursistHeeftVoorkennis)
                                        {
                                            <img class="img_StatusNoteGroen" />
                                        }
                                        else
                                        {
                                            <img class="img_StatusNoteRood" />
                                        }
                                    }

                                            @voorkennis.Naam
                                        </div>
                            }
                                </div>



                    }
                        </div>*@
            }

            @*<table>
                    <tr>
                        <th>Naam</th>
                        <th>Voorkennis</th>
                    </tr>
                    @foreach (Administratix.BLL.Module module in trajectModules)
                    {
                        <tr>
                            <td>
                                @if (module.CrursistIsIngeschreven)
                                {
                                    // Cursist is ingeschreven, geef punte status weer
                                    if (module.PuntenTotaal > 0)
                                    {
                                        // Cursist heeft punten
                                        if (module.CursistIsGeslaagd)
                                        {
                                            <img class="img_StatusCirkelGroen" />
                                        }
                                        else
                                        {
                                            <img class="img_StatusCirkelRood" />
                                        }
                                    }
                                    else
                                    {
                                        // Cursist heeft nog geen punten
                                        <img class="img_StatusCirkelOranje" />
                                    }
                                }
                                else
                                {
                                    // Cursist is niet ingeschreven, geen inschrijf status weer
                                    if (module.CursistHeeftVoorkennis)
                                    {
                                        <img class="img_StatusNoteGroen" />
                                    }
                                    else
                                    {
                                        <img class="img_StatusNoteRood" />
                                    }
                                }
                                @module.Naam
                            </td>
                            <td>
                                @foreach (Administratix.BLL.Module voorkennis in module.VoorkennisModules)
                                {
                                    <div>

                                        @if (voorkennis.CrursistIsIngeschreven)
                                        {

                                            if (voorkennis.PuntenTotaal > 0)
                                            {
                                                // Cursist heeft punten
                                                if (voorkennis.CursistIsGeslaagd)
                                                {
                                                    <img class="img_StatusCirkelGroen" />
                                                }
                                                else
                                                {
                                                    <img class="img_StatusCirkelRood" />
                                                }
                                            }
                                            else
                                            {
                                                // Cursist heeft nog geen punten
                                                <img class="img_StatusCirkelOranje" />

                                            }
                                        }
                                        else
                                        {
                                            // Cursist is niet ingeschreven, geen inschrijf status weer
                                            if (voorkennis.CursistHeeftVoorkennis)
                                            {
                                                <img class="img_StatusNoteGroen" />
                                            }
                                            else
                                            {
                                                <img class="img_StatusNoteRood" />
                                            }
                                        }

                                        @voorkennis.Naam
                                    </div>
                                }

                            </td>
                        </tr>
                    }
                </table>*@

